import"./modulepreload-polyfill-B5Qt9EMX.js";const n={products:[],elements:{select:null,addBtn:null,cartDisplay:null,totalDisplay:null,stockInfo:null},lastSelected:null,bonusPoints:0,totalAmount:0,itemCount:0},y=()=>{const t=n.elements.stockInfo;if(!t){console.log("stockInfo 렌더링 전");return}const e=n.products.filter(a=>a.q<5).map(a=>`${a.name}: ${a.q>0?`재고 부족 (${a.q}개 남음)`:"품절"}`).join(`
`);t.textContent=e},m=()=>{const t=n.elements.cartDisplay.children;if(!t)return;n.totalAmount=0,n.itemCount=0;let e=0;for(const l of t){const s=l.id,c=n.products.find(f=>f.id===s);if(!c)continue;const i=parseInt(l.querySelector("span").textContent.split("x ")[1],10),r=c.val*i;let d=0;i>=10&&(s==="p1"?d=.1:s==="p2"?d=.15:s==="p3"?d=.2:s==="p4"?d=.05:s==="p5"&&(d=.25)),e+=r,n.itemCount+=i,n.totalAmount+=r*(1-d)}let a=0;if(n.itemCount>=30){const l=e*.25,s=e-n.totalAmount;l>s?(n.totalAmount=e*.75,a=.25):a=s/e}else a=(e-n.totalAmount)/e;new Date().getDay()===2&&(n.totalAmount*=.9,a=Math.max(a,.1)),h(a),x(),y()},h=t=>{const e=n.elements.totalDisplay;if(e&&(e.textContent=`총액: ${Math.round(n.totalAmount)}원`,t>0)){const a=document.createElement("span");a.className="text-green-500 ml-2",a.textContent=`(${(t*100).toFixed(1)}% 할인 적용)`,e.appendChild(a)}},x=()=>{n.bonusPoints=Math.floor(n.totalAmount/1e3);let t=document.getElementById("loyalty-points");t||(t=document.createElement("span"),t.id="loyalty-points",t.className="text-blue-500 ml-2",n.elements.totalDisplay.appendChild(t)),t.textContent=`(포인트: ${n.bonusPoints})`},g=t=>{const e=t.dataset.productId,a=parseInt(t.dataset.change),o=document.getElementById(e),l=parseInt(o.querySelector("span").textContent.split("x ")[1])+a,s=l+a,c=n.products.find(r=>r.id===e),i=c.q+l;if(s>i){alert("재고가 부족합니다.");return}s<=0?o.remove():o.querySelector("span").textContent=`${c.name} - ${c.val}원 x ${s}`,c.q-=a,m()},C=t=>{const e=t.dataset.productId,a=document.getElementById(e),o=n.products.find(s=>s.id===e),l=parseInt(a.querySelector("span").textContent.split("x ")[1],10);o.q+=l,a.remove(),m()},v=t=>{const{target:e}=t;e.classList.contains("quantity-change")&&g(e),e.classList.contains("remove-item")&&C(e)},I=()=>{const t=n.elements.cartDisplay;if(!t){console.log("cartDisplay 아직 렌더링 전");return}t.addEventListener("click",v)},b=()=>{const t=n.elements.select.value,e=n.products.find(o=>o.id===t);if(!e||e.q<=0){alert("재고가 부족합니다.");return}const a=document.getElementById(t);a?q(a,e):E(e),m(),n.lastSelected=t},q=(t,e)=>{const a=parseInt(t.querySelector("span").textContent.split("x ")[1],10),o=a+1;if(o>e.q+a){alert("재고가 부족합니다.");return}t.querySelector("span").textContent=`${e.name} - ${e.val}원 x ${o}`,e.q--},E=t=>{const e=document.createElement("div");e.id=t.id,e.className="flex justify-between items-center mb-2",e.innerHTML=`
    <span>${t.name} - ${t.val}원 x 1</span>
    <div> 
        <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="' + itemToAdd.id + '" data-change="-1">-</button> +
        <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="' + itemToAdd.id + '" data-change="1">+</button> +
        <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="' + itemToAdd.id + '">삭제</button>
    </div>;
    `,n.elements.cartDisplay.appendChild(e),t.q--},D=()=>{const t=n.elements.addBtn;if(!t){console.log("addBtn 아직 렌더링 전");return}t.addEventListener("click",b)};function p(t,{className:e="",text:a="",id:o=""}={}){const l=document.createElement(t);return e&&(l.className=e),a&&(l.textContent=a),o&&(l.id=o),l}const u=()=>{const t=n.elements.select;if(!t){console.log("select 렌더링 전");return}t.innerHTML="",n.products.forEach(e=>{const a=document.createElement("option");a.value=e.id,a.textContent=`${e.name} - ${e.val}원`,e.q===0&&(a.disabled=!0),t.appendChild(a)})};function $(){n.products=[{id:"p1",name:"상품1",val:1e4,q:50},{id:"p2",name:"상품2",val:2e4,q:30},{id:"p3",name:"상품3",val:3e4,q:20},{id:"p4",name:"상품4",val:15e3,q:0},{id:"p5",name:"상품5",val:25e3,q:10}];const t=document.getElementById("app"),e=document.createElement("div"),a=document.createElement("div"),o=p("h1",{className:"text-2xl font-bold mb-4",text:"장바구니"});n.elements.addBtn=p("button",{className:"bg-blue-500 text-white px-4 py-2 rounded",text:"추가",id:"add-to-cart"}),n.elements.select=document.createElement("select"),n.elements.cartDisplay=document.createElement("div"),n.elements.totalDisplay=document.createElement("div"),n.elements.stockInfo=document.createElement("div"),n.elements.select.id="product-select",n.elements.cartDisplay.id="cart-items",n.elements.totalDisplay.id="cart-total",n.elements.stockInfo.id="stock-status",n.elements.select.className="border rounded p-2 mr-2",n.elements.totalDisplay.className="text-xl font-bold my-4",n.elements.stockInfo.className="text-sm text-gray-500 mt-2",a.className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8",e.className="bg-gray-100 p-8",a.appendChild(o),a.appendChild(n.elements.cartDisplay),a.appendChild(n.elements.totalDisplay),a.appendChild(n.elements.select),a.appendChild(n.elements.addBtn),a.appendChild(n.elements.stockInfo),e.appendChild(a),t.appendChild(e),u(),m(),D(),I(),k(),w()}function k(){setTimeout(()=>{setInterval(()=>{const t=n.products[Math.floor(Math.random()*n.products.length)];Math.random()<.3&&t.q>0&&(t.val=Math.round(t.val*.8),alert(`번개세일! ${t.name}이(가) 20% 할인 중입니다!`),u())},3e4)},Math.random()*1e4)}function w(){setTimeout(()=>{setInterval(()=>{if(!n.lastSelected)return;const t=n.products.find(e=>e.id!==n.lastSelected&&e.q>0);t&&(alert(`${t.name}은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!`),t.val=Math.round(t.val*.95),u())},6e4)},Math.random()*2e4)}$();
